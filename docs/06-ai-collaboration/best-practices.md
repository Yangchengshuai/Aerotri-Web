# AI 协作最佳实践

> **基于 Vibe Coding 实战经验总结的 34 条实战技巧**

本文档整理了在 Aerotri-Web 开发过程中积累的 AI 协作实战经验，涵盖从项目规划到实施再到维护的各个方面。

## 📋 目录

- [规划与设计](#规划与设计) - Plan模式、PRD共创、验收标准
- [协作技巧](#协作技巧) - 角色拆分、Agent指挥、授权管理
- [测试与验证](#测试与验证) - 测试视角、真实数据、理解确认
- [工具使用](#工具使用) - MCP/Skills、Git工作流、浏览器自动化
- [文档与知识](#文档与知识) - 官方文档、DDD、CLAUDE.md、AGENTS.md
- [上下文管理](#上下文管理) - 精准上下文、环境信息、代码定位
- [质量保证](#质量保证) - 代码对应、质量审查、对比验证
- [问题解决](#问题解决) - 死循环处理、环境问题、调试技巧

---

## 规划与设计

### 1. Plan 模式先行

复杂任务先制定 Plan，再 Coding。Plan 是"活文档"，可随开发迭代更新。

**实践要点**：
- 避免直接开始编码，先花 10-20% 时间制定计划
- Plan 应包含：目标、步骤、验收标准、风险预案
- 在开发过程中根据实际情况调整 Plan

**相关理念**: [苏格拉底提问法](./philosophy.md#2-苏格拉底提问法)

---

### 2. 多角色共创 PRD

模拟高级前端、后端、算法专家、产品经理，多轮讨论澄清需求，形成可执行 PRD 和开发 Plan。

**实践要点**：
- 从多个角色视角审查需求
- 识别不同角色的关注点和约束
- 通过多轮对话形成共识

**适用场景**:
- 复杂功能的设计
- 跨模块协作
- 架构决策

---

### 3. 明确验收标准

文档阶段明确"完成标准"，避免功能无限扩展或返工。

**验收标准应包含**:
- 功能完整性检查清单
- 性能指标要求
- 测试用例通过标准
- 文档完备性要求

**优势**:
- 避免范围蔓延
- 减少返工
- 提高交付质量

---

### 4. 方案调研先行并文档化

使用 ChatGPT 或深度研究调研方案，沉淀为 .md 文档，再输入 AI 优化整体 Plan。

**流程**:
```
问题识别 → 调研方案 → 文档化 → AI优化 → Plan
```

**产出**:
- 方案调研文档 (`docs/research/xxx.md`)
- 技术选型分析
- 实施方案对比

---

## 协作技巧

### 5. 角色拆分驱动实现

不同角色关注不同领域，各司其职：

- **前端**: 关注 UI/交互、用户体验
- **后端**: 聚焦数据和系统稳定
- **产品经理**: 关注使用流程、需求完整性
- **算法工程师**: 关注假设与边界、算法准确性

**实施方式**:
- 为 AI Agent 分配明确角色
- 在 Prompt 中定义角色职责
- 建立角色间的协作机制

---

### 6. 测试工程师视角

每个功能集成后先测试，失败立即修改 Plan，基于真实测试数据验证功能可用性。

**测试驱动流程**:
1. 定义测试用例
2. 执行测试
3. 分析失败原因
4. 修改 Plan 或代码
5. 重新测试

**价值**:
- 及早发现问题
- 基于真实数据验证
- 避免后期大规模返工

---

### 7. AI 团队管理者

**开发者从编码者转变为 AI 团队管理者**：
- 设定目标
- 划分职责
- 质量把关

**核心能力**:
- 判断力: 在多个方案中做出最优选择
- 审美: 知道什么是美，深刻理解人性需求
- 品味: 独特的世界观
- 指挥: 给 AI 挑毛病，提升质量

**关键转变**:
- ❌ 旧: 自己写代码
- ✅ 新: 给 AI 设定目标，让 AI 实现

---

### 8. 给 Agent 设定不同的角色

给 agent 进行授权/permissions，可以让 agent 根据沉淀下来的经验帮助审查代码质量。

**角色示例**:
- `code-simplifier`: 代码简化专家
- `code-reviewer`: 代码审查专家
- `test-engineer`: 测试工程师
- `documentation-writer`: 文档编写者

**授权原则**:
- 只授予必要的权限
- 明确责任边界
- 建立审查机制

---

### 9. Agent 时代，搭建自己的自动化工作流

例如自动化内容创作工作流：文案 + 视频 + 音频 + 图片

**工作流示例**:
```
需求输入 → Agent1(文案) → Agent2(视频) → Agent3(音频) → Agent4(图片) → 成品输出
```

**优势**:
- 提高生产效率
- 降低人工成本
- 规模化生产

---

## 测试与验证

### 10. 少量真实数据驱动迭代

少量真实数据比大量描述更有效，可持续测试、快速迭代。

**实践方法**:
- 准备 5-10 个真实测试用例
- 每次迭代都用真实数据验证
- 根据测试结果调整方案

**优势**:
- 快速发现问题
- 避免过度设计
- 基于真实反馈优化

---

### 11. AI 理解确认与测试数据

每个关键功能提供测试数据，多轮对话确保 AI 理解需求。

**确认方法**:
- 提供输入输出示例
- 要求 AI 复述理解
- 检查边界情况处理

**测试数据应包含**:
- 正常情况
- 边界值
- 异常情况

---

### 12. 提供参考用例进行对比验证

目录结构、输入输出结果对比，快速判断实现偏离。

**对比维度**:
- 文件结构对比
- 输出格式对比
- 性能指标对比
- 用户体验对比

---

## 工具使用

### 13. 优先使用高级模型

高级模型理解复杂需求和工具能力更强，可减少反复修改成本。

**推荐**:
- GPT-4 / Claude 3.5 Sonnet / Claude 3 Opus
- 避免 GPT-3.5 等较低级模型用于复杂任务

**成本效益分析**:
- 高级模型虽然单次成本高
- 但理解能力强，减少迭代次数
- 总成本反而更低

---

### 14. 先优化 Prompt，再交给 AI 执行

好的 Prompt 是高效执行的前提。

**Prompt 优化技巧**:
- 明确角色和目标
- 提供具体示例
- 定义输出格式
- 设置约束条件

**Prompt 模板**:
```
你是 [角色]，需要完成 [任务]。

**上下文**:
- [相关信息]

**要求**:
1. [具体要求1]
2. [具体要求2]

**输出格式**:
[格式说明]

**约束**:
- [约束条件]
```

---

### 15. 引入 MCP / Skills

**Playwright MCP**: 自动操作浏览器
- 自动化测试
- 页面截图
- 表单填写

**前端 Skills**: 去除"AI味"
- 使用现代前端框架规范
- 遵循最佳实践
- 提高代码质量

**Git Skills**: 规范工作流
- 自动化分支管理
- 规范提交信息
- 代码审查流程

---

### 16. 使用 Superpower Skill，浏览器自动化 Skill

- 模型的决策能力有限
- 给它工具，它未必会用
- 需要通过 Skill 封装工具使用逻辑

**实践建议**:
- 为常用工具创建 Skill
- 封装最佳实践
- 提供使用示例

---

## 文档与知识

### 17. 提供官方文档和示例

避免 AI 使用错误接口或加载错误。

**应该提供**:
- API 文档链接
- 代码示例
- 配置说明
- 常见问题解答

**示例**:
```markdown
## Cesium 源码查看 API 使用

**官方文档**: https://cesium.com/docs/
**API 参考**: https://cesium.com/learn/apiref/

**常用示例**:
- 加载 3D Tiles
- 相机控制
- 数据可视化
```

---

### 18. 文档驱动开发（DDD）持续跟踪

文档持续更新，用于跟踪开发、测试结果和经验沉淀。

**文档内容**:
- 开发 Plan
- 测试结果
- 经验总结
- 问题记录

**更新频率**:
- 每个迭代结束时
- 发现重要经验时
- 解决关键问题时

---

### 19. 复利效应，不断沉淀总结经验到 CLAUDE.md 中

与 AI 协作过程产生复利工程效应（Compounding Engineering，Every 创始人 Dan Shipper）。

协作过程沉淀可复用的知识资产。

**实践方法**:
- 每次解决问题后记录到 CLAUDE.md
- 使用索引压缩到 8KB（AGENTS.md）
- 只记录位置，不记录全文

**价值**:
- 第1次: 花2小时解决问题
- 第2次: 花5分钟检索并解决
- 第N次: 秒级定位问题

---

### 20. AGENTS.md：压缩到仅 8KB 的索引

只是 8KB 的索引，不是完整文档。索引指向可检索文件即可，无需全量文档。

**用途**:
- 让 Agent 知道去哪儿找
- 需要的时候再读具体文件
- 减少 Context Token 消耗

**结构**:
```markdown
## 性能优化
- [COLMAP 参数调优](../docs/04-algorithms/#colmap-调优)
- [GPU 内存优化](../CLAUDE.md#gpu-配置)

## 测试相关
- [测试数据准备](../tests/README.md)
- [单元测试指南](../docs/05-development/#测试)
```

---

## 上下文管理

### 21. 提供精准的上下文

**示例**:
- ✅ 相关代码文件，而不是整个工程
- ✅ 单个代码文件，而不是多个代码文件
- ✅ 最近 500 行日志，而不是全部日志

**反例**:
- ❌ 提供整个 CLAUDE.md（16KB+）
- ❌ 提供整个工程代码（100MB+）
- ❌ 提供全部日志文件（可能数 MB）

**优势**:
- 减少 Token 消耗
- 提高 AI 理解准确度
- 加快响应速度

---

### 22. 技术路线文档与环境信息全量提供

CUDA、依赖库、算法框架版本一次性给全，必要时使用 conda / env 隔离。

**应包含**:
```bash
# 环境信息
- CUDA 版本: 12.1
- Python 版本: 3.10
- 操作系统: Ubuntu 22.04

# 依赖库
- PyTorch: 2.1.0
- COLMAP: 3.8
- Ceres Solver: 2.1.0

# 算法框架
- 3DGS: commit hash
- OpenMVS: version 2.0.0
```

**避免**:
- 逐步提供环境信息
- 隐藏关键版本信息
- 假设 AI 知道环境

---

## 质量保证

### 23. 解析代码时，要让分析与代码对应

输出的文档中，每个部分要对应代码。

**示例**:
```markdown
### 🔍 错误分析

**问题代码**:
```python
# file.py:123
def process_image(image):
    return transform(image)
```

**修复代码**:
```python
# file.py:123
def process_image(image):
    # 添加验证逻辑
    if not is_valid(image):
        raise ValueError("Invalid image")
    return transform(image)
```

**修改建议**:
- 文件: `file.py`
- 行号: 123
- 改动: 添加验证逻辑
```

**价值**:
- 可追溯到具体位置
- 便于验证修改
- 减少歧义

---

### 24. 提供Cesium源码查看API使用和数据结构

**适用场景**:
- API 使用不明确
- 数据结构不清楚
- 参数含义模糊

**方法**:
- 链接到官方文档
- 提供代码示例
- 截图源码说明

---

## 问题解决

### 25. AI 死循环及时人工介入

多次尝试仍无进展，问题在方向，而非尝试次数。

**死循环特征**:
- 同样的错误反复出现
- 修改后无改善
- AI 重复尝试无效方法

**介入时机**:
- 尝试 3 次无进展
- AI 陷入重复
- 超过预定时间

**介入方式**:
- 人工分析根本原因
- 调整方向或方法
- 寻求人工帮助

---

### 26. 低成本解决环境问题

重启 Docker / Server 有时能解决缓存或状态异常问题。

**适用场景**:
- 莫名其妙的错误
- 缓存相关问题
- 状态异常

**尝试顺序**:
1. 重启服务
2. 清除缓存
3. 重启容器
4. 检查环境变量

**成本**:
- 时间成本: < 5分钟
- 操作成本: 低
- 风险: 低

---

### 27. 前端 F12 控制台报错必备

高效定位前端 Bug。

**常用功能**:
- Console 查看日志
- Network 查看请求
- Elements 检查 DOM
- Sources 断点调试

**常见错误类型**:
- JavaScript 错误
- 网络请求失败
- 样式加载问题
- 资源 404

---

### 28. 算法链路先手动跑通再集成

单模块验证正确后再做系统集成，避免问题叠加。

**流程**:
```
模块A单独测试 → 通过 ✅
模块B单独测试 → 通过 ✅
模块C单独测试 → 通过 ✅
系统集成 → 发现问题
  ↓
定位问题：是模块A/B/C还是集成问题？
```

**价值**:
- 缩小问题范围
- 减少调试时间
- 提高成功率

---

## 📚 相关文档

- **[核心理念](./philosophy.md)** - AI 协作的 5 个核心原则
- **[案例研究](./case-studies/)** - 具体应用案例
- **[CLAUDE.md](../CLAUDE.md)** - 项目知识库
- **[README.md](../README.md)** - 项目概述

---

## 🎯 实践建议

### 如何使用本文档

**新手入门**:
1. 先阅读 [核心理念](./philosophy.md)
2. 选择感兴趣的实践主题
3. 在实际项目中尝试应用
4. 记录经验和反馈

**有经验开发者**:
1. 快速浏览，查漏补缺
2. 深入理解尚未掌握的实践
3. 优化自己的 AI 协作工作流
4. 分享你的实践经验

**项目负责人**:
1. 参考"规划与设计"章节制定 Plan
2. 使用"协作技巧"组建团队
3. 建立"质量保证"机制
4. 持续优化"工具使用"和"文档与知识"

---

## 🔄 持续更新

本文档是活跃维护的"活文档"，欢迎贡献：

1. 在实践中发现新的最佳实践
2. 更新过时的实践建议
3. 补充实际案例和经验
4. 完善文档结构和分类

---

**更新时间**: 2026-02-16
**维护者**: Aerotri-Web Team
**基于**: Vibe Coding 实战经验总结

---

**相关资源**:
- [Vibe Coding](https://vibecoding.com/) - 原始视频系列
- [Every 通用](https://every.to/) - AI 工具导航
- [CLAUDE Code](https://claude.ai/code) - AI 协作开发工具
